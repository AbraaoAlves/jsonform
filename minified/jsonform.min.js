/* jsonform.js */
/*
 Copyright Milfont Consulting.
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(g){g.fn.extend({version:"1.2.4",getJSON:function(e){var b={},a=this,c;"object"===typeof e&&(c=e,e=c.byId?c.byId:!1);a.find("input,textarea,select").each(function(d,f){if("radio"!=f.type||f.checked){var k=e?g.trim(f.id):g.trim(f.name),i="select-multiple"===f.type?g(f).val():f.value;""!==k&&("checkbox"==f.type&&(i=f.checked?!0:!1),a.merge(b,a.buildJson(k,i,c)))}});return b},populate:function(e,b){var a=function(a){return a.every(function(a){return"object"!=typeof a})},c=this;(function f(k,
i){for(var l in k)if(k[l]||0===k[l]){var h=k[l];if("object"==typeof h&&(!g.isArray(h)||!a(h))){var j=!i?l:i+"\\."+l;if(g.isArray(h))for(var e in h)h[e]&&f(h[e],j+"\\["+e+"\\]");else f(h,j)}else{var j=i?i+"\\."+l:l,m="[name='"+j+"']";b&&(m="#"+j);var n=c.find(m);0===n.length&&(m=m.replace(/\\\[(\d+)?\\\]/g,"\\[\\]"),j=j.replace(/[^\\\[(\d+)?\\\]]/g,"").replace(/[^\d+]/g,""),n=c.find(m).eq(j));n.val(h)}}})(e);return this},buildJson:function(e,b,a){var c=a&&a.prefix?a.prefix:"",d=a&&a.suffix?a.suffix:
"",f=function(a,b){var c=a.match(/\[(\d?)\]/);if(c){var h=[],d=0;""!==c[1].trim()&&(d=c[1]);h[d]=b;return h}return b};return function i(a,b,e){var b=b.split("."),g=b.shift();a[c+g.replace(/\[(\d?)\]/,"")+d]=0<b.length?f(g,i({},b.join("."),e)):f(g,e);return a}({},e,b)},merge:function b(a,c){for(var d in c)"object"===typeof c[d]&&"undefined"!==typeof a[d]?g.isArray(a[d])&&g.isArray(c[d])&&!Object.Equals(a[d],c[d].clean())?a[d].push(c[d][0]):b(a[d],c[d]):a[d]=c[d];return a}});Object.Equals=Object.Equals||
function(b,a){return JSON.stringify(b)===JSON.stringify(a)};Array.prototype.clean=function(){for(var b=0;b<this.length;b++)if(null===this[b]||void 0===this[b])this.splice(b,1),b--;return this}})(jQuery);